# 190126 jsbulog

## Subject: What is CI / CD ?

## Content:

### CI / CD 란 무엇일까 ? 내가 작성한 코드는 어떻게 배포가 될까? 개발 이야기지만 다분히 비개발 적인 어조로 풀어내는 이야기.

CI (Continuous Integration), CD (Continuous Deploy or Delivery)의 준말이다.
지속적인 통합과 지속적인 배포 ..? 감은 잘 오지 않는 단어이다.
그래서 나의 언어로 조금 바꿔보면 이런식으로 표현 할 수 있을 것 같다.

```
git에 지속적으로 merge 되고, 그 코드가 지속적으로 프로덕트에 반영 되는 것.
```

아직도 조금 생소 할 수 있을 것 같다. 그렇다면 일반적으로 우리가 development 단계에서 코딩을 하고,
이 코드가 웹 상에 배포 되기 까지는 어떤 과정을 거칠까?

우선 우리는 협업 및 버전관리를 하기 위해 git을 활용 할 것이고, 이런 git을 조금더 수월하게 관리 하기 위해 github라는 플랫폼을 사용하게된다.

그래서 혼자 혹은 두명이상의 개발자가 하나의 코드베이스를 두고 개발을 시작하게된다.

개발을 하게 되면서, 특정 feature의 작업이완료되면 아마 github원격 저장소로 pr을 날리게 되고, 여러 pr이 모여서 하나의 코드가 되어간다.

여러 개발자 들의 여러 커밋을 거치면서, PR들이 merge 되는 과정, conflict되는 과정 conflict를 resolve 하는 과정등을 거치면서 코드는 MVP가 되어 간다.

그럼 MVP가 된 코드는 어떻게 배포 되는가 ?

우선 `배포`에 대해서 내가 내린 정의는 다음과 같다.

```
localhost에서만 동작하고 있던 나의 코드를 나 이외의 사람들이 접근 할 수 있는 컴퓨터에서 code를 run하는 것.
```

그렇다. 코드가 배포가 될려면, 내 컴퓨터 상에서는 할 수가 없다.(물론 가능은 하다.)

내가 가지고 있는 컴퓨터 상에서 배포를 하는것이 매우 제한되기 때문에, 우리는 배포를 할려면 누구나 접근 할 수 있는 컴퓨터를 빌리거나 사야한다.

예전에는 그 컴퓨터를 사서 흔한 건물에 하나씩 있는 서버실을 구축 하고 해당 컴퓨터에 내 코드를 넣어서 배포를 했었다고 한다. 하지만 우리는 아마존의 시대에 살고 있다.

더이상 물리적인 선을 직접 연결해서 (사실 누군가는 하고 있겠지만) 서버를 배포 하지 않아도 된다. 우리는 컴퓨터를 빌릴 수 있고, 거기서 배포를 할 수 있다.

자, 그럼 우리는 아마존(혹은 Microsoft, KT? 등등의 cloud service)에서 컴퓨터를 빌렸다. 하지만 이 컴퓨터는 UI 가 있는 것도 아니고 그냥 단순 터미널에 접속만 할 수 있을 뿐이고, 물리적 컴퓨터가 아니기 때문에 usb포트도 없다.

우리가 작성한 코드를 여기 컴퓨터로 전송 해야되는데 물리적 실체가 없으니 참으로 난감하다. 이떄 필요한 것이 git 원격 저장소이다.

aws에서 우리가 빌린 컴퓨터는 다행히도 인터넷에는 연결 되어 있다. 따라서 github 원격 저장소에 접속해서 우리 코드를 복사해갈 수 있다.

git에서 코드를 내려받기 까지 했다. 하지만 배포는 여기서 끝이 아니다. 이 컴퓨터는 내컴퓨터가 아니다. 내가 깔아 놓은 그 흔한 node도 깔려있지 않다. 근데 내가 작성한 코드는 node 라는 런타임 위에서 작동한다. 그렇다 우리는 node까지 깔아주어야 한다.

컴퓨터가 똑똑한 줄 알았는데 생각보다 멍청하다. 다 해줘야 한다.

아무튼 우리는 컴퓨터를 빌렸고, 코드도 복사했고, 복사한 코드가 뛰어 놀 수 있는 런타임도 깔아줬다. 이 코드를 런타임에서 뛰어놀게 해주면 1차적인 배포는 성공이다.(말은 쉽지만 과정이 참 길다.)

첫 MVP가 배포가 되었다. 주제가 CI / CD였는데, 한참동안 코드 배포에 대한 이야기를 했다.

내가 배포에 대해서 한참동안 얘기 한 이유는, 배포를 하는 과정이 이만큼 귀찮다는 것이다. 한번 배포 셋팅이 종료 된 이후에도 우리는 코드를 업데이트 하기 위
해서,

1. 코드를 작성한다.
2. 깃허브에 코드를 올린다.
3. 컨플릭이 있다면 해결하고, 이후에 코드를 머지한다.
4. 머지한 코드를 다시 aws컴퓨터에 원격 접속해서 git을 통해서 pull 받아온다.
5. 코드를 다시 실행 시킨다.

6. ....? 안된다...

열심히 위의 과정을 거쳐서 배포 했더니 안되면 ..? 우리는 코드를 다시 뒤로 롤백 해야한다.

배포라는 것은 참으로 험난한 일이다. 이렇게 자꾸 배포가 힘들다는 것을 얘기 하는 이유는, CI / CD 라는 것이 이 모든 과정을 매우 수월하게 해주기 때문이다.

CI / CD 라는 시스템을 구축 한다는 것은 다음과 같다.

CI : 지속적으로 코드를 통합한다. 자동으로. 그러려면? 이 코드가 merge가 되어도 되는 코드인지에 대한 보장이 필요하다.

CD : 지속적으로 코드를 배포한다. 자동으로. 그러려면? 이 코드가 배포가 되어도 되는 코드인지에 대한 보장이 필요하다.

위의 과정을 보장 하려면? 정답은 test다. 내생각에 위 과정 중 1 ~ 5의 과정을 자동화 하는 것은 생각보다 간단한 task일 수 있고, 이를 위한 엄청난 좋은 툴 들이 존재한다.

CI를 하면서 코드에 대한 보장을 받기 위해서 pull request 를 날린 코드를 특정 독립 환경에서 실행 시키고, 각종 테스트 들을 돌려본다.
(circle ci가 빙글빙글 돌면서 v표시 혹은 x표시를 띄우는 것이 이런거다.)
CI tool 이 돌린 테스트가 모두 정상적으로 통과가 되었다면, 우리는 코드 통합을 한다.

이제 디플로이만 남았다. 깃허브 원격 저장소에 통합된 코드를 CD를 위해서 또 다른 독립적인 배포환경과 유사한 곳에서 실행 시켜본다. 이때 아마 docker를 활용 한다.

이번엔 또 독립적인 Docker container에서 배포환경과 최대한 유사한 환경을 구축 하고 이번엔 github에서 통합된 코드를 가져와 마찬가지로 테스트 과정을 거친다. 아마도 테스트를 돌려보니 실패가 있으면 아마도 코드 배포를 진행 하지 않을 것 이고, 테스트가 성공적 이라면, staging을 할 것이다. 물론 이번에는 다양한 이유로, ( 마케팅팀이 싫어해요, 유저경험이 별로에요)등의 이유로 최종 프로덕션에 배포 되지 않을 확률도 존재하지만.

만약 CI CD시스템을 구축하지 않는다면?(사실 나도 구축하지 않은 서비스를 만들고 있다..)
우리는 PR을 날리기전에 여러가지 테스트 들을 수동으로 해봐야 한다. 블로그를 예로 들면 글을 작성 해보고 지워도 보고 로그인도 해보고 수정도 해보고 등등등.

로컬에서 잘되서 코드를 Merge 하였으면, 실제 프로덕트 배포환경과 유사한 환경, 거의 동일한 환경에 배포를 하고 또 글을 지워보고 작성해보고 지워도보고 로그인도해보고.. 등등..

잘되서 이번엔 프로덕션 코드에 합친다. 프로덕션 코드에 합친 뒤에도 로그인도 해보고 지워도 보고 .. 등등등

몹시 개발자스럽지 않은 과정을 손수 거쳐야 한다.

아무튼 내가 두서없이 써내린 글들을 요약하면, 내가 작성한 코드가 배포가 되기 위해서는 엄청 복잡한 과정을 거쳐야 하고, 이 복잡한 과정을 단순하게, 자동화 해주는 것이 CI / CD 이다.

물론 그 과정을 자동화 하는 과정 자체는 엄청 복잡 할 수 있지만, 되어 있지 않은 체로 프로덕트가 이미 사이즈가 커졌을 때 감내해야 하는 과정을 생각 하면!

나처럼 초주니어 개발자들 이라도, CI CD 과정을 한번쯤 공부 해보는 것도 나쁘지 않다고 생각 한다!

회사에서 내가 만든 컴포넌트가 어떻게 배포되는지도 모르고 앉아서 코딩만 하고 있는 코더가 되지 않길 바라는 마음으로 글을 마무리 하겠다!
